import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState } from 'react';
import { toLocalNum } from '../utils/translations.js';
const Plans = ({ dietPlan, workoutPlan, dailyProgress, onToggleMeal, onToggleExercise, onRequestAlternative, t, language }) => {
    const [activeTab, setActiveTab] = useState('diet');
    const [showReview, setShowReview] = useState(false);
    const mealOrder = ['breakfast', 'lunch', 'snack', 'dinner'];
    const nextMealKey = mealOrder.find(key => !dailyProgress.completedMeals.includes(key));
    const completedMealKeys = dailyProgress.completedMeals;
    let caloriesIn = 0;
    mealOrder.forEach(key => {
        if (completedMealKeys.includes(key)) {
            // @ts-ignore
            caloriesIn += dietPlan.meals[key]?.calories || 0;
        }
    });
    let caloriesOut = 0;
    dailyProgress.completedExercises.forEach(idx => {
        const ex = workoutPlan.exercises[idx];
        if (ex) {
            caloriesOut += ex.estimatedCaloriesBurned || 50;
        }
    });
    const isDayFinished = !nextMealKey && dailyProgress.completedExercises.length === workoutPlan.exercises.length;
    const sleepHours = 8;
    const getNextMealDisplay = () => {
        if (!nextMealKey)
            return t.doneMeals;
        // @ts-ignore
        return `${t.target}: ${dietPlan.meals[nextMealKey]?.name}`;
    };
    const totalExercises = workoutPlan.exercises.length;
    const doneExercises = dailyProgress.completedExercises.length;
    const exercisesProgress = Math.round((doneExercises / totalExercises) * 100);
    // DAY FINISHED VIEW (Detailed Tomorrow's Plan)
    if (isDayFinished && !showReview) {
        return (_jsxs("div", { className: "min-h-full bg-indigo-900 text-white p-6 relative overflow-y-auto", children: [_jsx("div", { className: "absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-yellow-400 to-pink-500" }), _jsx("h2", { className: "text-3xl font-bold mb-2 mt-4 text-center", children: t.perfectDay }), _jsx("p", { className: "opacity-90 mb-6 text-indigo-200 text-center", children: t.completedTasks }), _jsxs("div", { className: "flex justify-center gap-6 mb-8", children: [_jsxs("div", { className: "bg-white/10 p-4 rounded-xl border border-white/10 text-center", children: [_jsx("span", { className: "block text-2xl font-bold text-teal-300", children: toLocalNum(caloriesIn, language) }), _jsx("span", { className: "text-xs opacity-75", children: t.gained })] }), _jsxs("div", { className: "bg-white/10 p-4 rounded-xl border border-white/10 text-center", children: [_jsx("span", { className: "block text-2xl font-bold text-orange-300", children: toLocalNum(caloriesOut, language) }), _jsx("span", { className: "text-xs opacity-75", children: t.burned })] })] }), _jsxs("div", { className: "bg-indigo-800 p-4 rounded-xl border border-indigo-700 mb-8", children: [_jsxs("div", { className: "flex items-center gap-3 mb-2", children: [_jsx("span", { className: "text-3xl", children: "\uD83D\uDE34" }), _jsx("h3", { className: "text-xl font-bold", children: t.sleepTime })] }), _jsxs("p", { className: "text-sm opacity-90 leading-relaxed", children: [t.sleepAdvice, " ", _jsxs("span", { className: "font-bold text-yellow-400", children: [toLocalNum(sleepHours, language), " ", t.hours] }), "."] })] }), _jsxs("h3", { className: "text-xl font-bold mb-4 flex items-center gap-2 border-b border-white/20 pb-2", children: [_jsx("span", { children: "\uD83D\uDCC5" }), " ", t.tomorrowsMenu] }), _jsxs("div", { className: "space-y-3 mb-10 grid grid-cols-1 md:grid-cols-3 gap-4", children: [_jsxs("div", { className: "bg-white/10 p-4 rounded-xl border border-white/5", children: [_jsxs("div", { className: "flex justify-between items-center mb-1", children: [_jsx("span", { className: "font-bold text-yellow-300 text-lg", children: t.breakfast }), _jsxs("span", { className: "text-xs bg-black/30 px-2 py-1 rounded", children: [toLocalNum(dietPlan.meals.breakfast.calories, language), " ", t.calories] })] }), _jsx("p", { className: "text-sm text-gray-300", children: dietPlan.meals.breakfast.name })] }), _jsxs("div", { className: "bg-white/10 p-4 rounded-xl border border-white/5", children: [_jsxs("div", { className: "flex justify-between items-center mb-1", children: [_jsx("span", { className: "font-bold text-green-300 text-lg", children: t.lunch }), _jsxs("span", { className: "text-xs bg-black/30 px-2 py-1 rounded", children: [toLocalNum(dietPlan.meals.lunch.calories, language), " ", t.calories] })] }), _jsx("p", { className: "text-sm text-gray-300", children: dietPlan.meals.lunch.name })] }), _jsxs("div", { className: "bg-white/10 p-4 rounded-xl border border-white/5", children: [_jsxs("div", { className: "flex justify-between items-center mb-1", children: [_jsx("span", { className: "font-bold text-blue-300 text-lg", children: t.dinner }), _jsxs("span", { className: "text-xs bg-black/30 px-2 py-1 rounded", children: [toLocalNum(dietPlan.meals.dinner.calories, language), " ", t.calories] })] }), _jsx("p", { className: "text-sm text-gray-300", children: dietPlan.meals.dinner.name })] })] }), _jsxs("button", { onClick: () => setShowReview(true), className: "w-full bg-white/10 hover:bg-white/20 text-white py-4 rounded-xl text-sm font-bold transition border border-white/20 mb-10", children: [t.reviewToday, " \uD83D\uDCCB"] })] }));
    }
    return (_jsxs("div", { className: "pb-6 pt-6 px-4", children: [_jsxs("div", { className: "flex justify-between items-center bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-4", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "text-xs text-gray-500", children: t.gained }), _jsx("span", { className: "font-bold text-teal-600 text-sm", children: toLocalNum(caloriesIn, language) })] }), _jsx("div", { className: "h-4 w-[1px] bg-gray-200" }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: "text-xs text-gray-500", children: t.burned }), _jsx("span", { className: "font-bold text-orange-500 text-sm", children: toLocalNum(caloriesOut, language) })] })] }), isDayFinished && showReview && (_jsx("div", { className: "bg-green-100 border border-green-200 text-green-800 text-xs font-bold px-4 py-2 rounded-lg mb-4 text-center", children: t.completedTasks })), _jsxs("div", { className: "flex bg-gray-100 p-1 rounded-xl mb-6", children: [_jsxs("button", { onClick: () => setActiveTab('diet'), className: `flex-1 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'diet' ? 'bg-white text-teal-600 shadow-sm' : 'text-gray-500'}`, children: ["\uD83E\uDD51 ", t.dietPlan] }), _jsxs("button", { onClick: () => setActiveTab('workout'), className: `flex-1 py-2 rounded-lg text-sm font-bold transition ${activeTab === 'workout' ? 'bg-white text-orange-500 shadow-sm' : 'text-gray-500'}`, children: ["\uD83D\uDCAA ", t.workoutPlan] })] }), activeTab === 'diet' ? (_jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "text-center mb-4 bg-teal-50 py-3 rounded-xl border border-teal-100", children: [_jsxs("p", { className: "text-xs text-teal-600 mb-1", children: [t.target, ": ", toLocalNum(dietPlan.dailyCalories, language), " ", t.calories] }), _jsx("p", { className: "font-bold text-teal-800 text-lg", children: getNextMealDisplay() })] }), _jsxs("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: [_jsx(MealCard, { title: t.breakfast, meal: dietPlan.meals.breakfast, color: "yellow", mealKey: "breakfast", isDone: dailyProgress.completedMeals.includes('breakfast'), onToggle: () => onToggleMeal('breakfast'), onRequestAlternative: onRequestAlternative, t: t, language: language }), _jsx(MealCard, { title: t.lunch, meal: dietPlan.meals.lunch, color: "green", mealKey: "lunch", isDone: dailyProgress.completedMeals.includes('lunch'), onToggle: () => onToggleMeal('lunch'), onRequestAlternative: onRequestAlternative, t: t, language: language }), _jsx(MealCard, { title: t.snack, meal: dietPlan.meals.snack, color: "purple", mealKey: "snack", isDone: dailyProgress.completedMeals.includes('snack'), onToggle: () => onToggleMeal('snack'), onRequestAlternative: onRequestAlternative, t: t, language: language }), _jsx(MealCard, { title: t.dinner, meal: dietPlan.meals.dinner, color: "blue", mealKey: "dinner", isDone: dailyProgress.completedMeals.includes('dinner'), onToggle: () => onToggleMeal('dinner'), onRequestAlternative: onRequestAlternative, t: t, language: language })] })] })) : (_jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "bg-orange-50 p-4 rounded-xl border border-orange-100 mb-4", children: [_jsxs("div", { className: "flex justify-between items-center mb-2", children: [_jsx("h3", { className: "font-bold text-orange-800 text-lg", children: workoutPlan.type }), _jsxs("span", { className: "text-xs font-bold text-orange-600", children: [toLocalNum(doneExercises, language), " / ", toLocalNum(totalExercises, language), " ", t.exercises] })] }), _jsx("div", { className: "w-full bg-orange-200 h-2 rounded-full overflow-hidden", children: _jsx("div", { className: "bg-orange-500 h-full transition-all duration-500", style: { width: `${exercisesProgress}%` } }) }), _jsx("p", { className: "text-xs text-orange-600 mt-2 text-center", children: exercisesProgress === 100 ? t.greatJob : "Go Go Go!" })] }), _jsx("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-4", children: workoutPlan.exercises.map((ex, idx) => (_jsx(ExerciseCard, { exercise: ex, index: idx, isDone: dailyProgress.completedExercises.includes(idx), onToggle: () => onToggleExercise(idx), t: t, language: language }, idx))) })] }))] }));
};
const MealCard = ({ title, meal, color, isDone, onToggle, onRequestAlternative, t, language }) => {
    const colorClasses = {
        yellow: "bg-yellow-50 border-yellow-200 text-yellow-800",
        green: "bg-green-50 border-green-200 text-green-800",
        blue: "bg-blue-50 border-blue-200 text-blue-800",
        purple: "bg-purple-50 border-purple-200 text-purple-800",
    }[color] || "bg-gray-50 border-gray-200 text-gray-800";
    return (_jsxs("div", { className: `p-4 rounded-2xl border transition-all duration-300 h-full flex flex-col justify-between ${isDone ? 'bg-gray-50 border-gray-200 opacity-70 grayscale' : colorClasses}`, children: [_jsxs("div", { children: [_jsxs("div", { className: "flex justify-between items-start mb-2", children: [_jsx("h3", { className: `font-bold text-lg ${isDone ? 'line-through decoration-2' : ''}`, children: title }), _jsx("button", { onClick: onToggle, className: `w-8 h-8 rounded-full flex items-center justify-center border-2 transition ${isDone ? 'bg-green-500 border-green-500 text-white' : 'border-current bg-transparent'}`, children: isDone && "✓" })] }), !isDone && (_jsxs(_Fragment, { children: [_jsxs("div", { className: "flex justify-between items-baseline mb-1", children: [_jsx("p", { className: "font-bold", children: meal.name }), _jsxs("span", { className: "text-xs bg-white/50 px-2 py-1 rounded-lg font-bold", children: [toLocalNum(meal.calories, language), " ", t.calories] })] }), _jsx("p", { className: "text-sm opacity-80 mb-3 line-clamp-3", children: meal.description }), _jsxs("div", { className: "flex gap-2 text-xs opacity-70 mb-3", children: [_jsxs("span", { children: [t.protein, ": ", toLocalNum(meal.protein, language), "g"] }), " |", _jsxs("span", { children: [t.carbs, ": ", toLocalNum(meal.carbs, language), "g"] }), " |", _jsxs("span", { children: [t.fat, ": ", toLocalNum(meal.fat, language), "g"] })] })] }))] }), !isDone && (_jsx("div", { className: "flex justify-between items-center border-t border-black/10 pt-3 mt-2", children: _jsxs("button", { onClick: () => onRequestAlternative(title, meal.calories), className: "flex items-center gap-1 bg-white/60 hover:bg-white text-xs font-bold px-3 py-2 rounded-lg shadow-sm transition border border-black/5", children: [_jsx("span", { className: "text-base", children: "\u267B\uFE0F" }), t.alternativeRequest] }) })), isDone && (_jsxs("div", { className: "text-center py-2 text-green-600 font-bold text-sm bg-green-50/50 rounded-lg mt-2 border border-green-100", children: [_jsx("span", { className: "block text-lg mb-1", children: "\uD83D\uDE0B" }), t.gained, " ", _jsx("span", { className: "font-bold", children: toLocalNum(meal.calories, language) })] }))] }));
};
const ExerciseCard = ({ exercise, index, isDone, onToggle, t, language }) => {
    const searchQuery = exercise.youtubeSearchQuery || `${exercise.name} exercise tutorial`;
    return (_jsxs("div", { className: `bg-white p-4 rounded-xl shadow-sm border transition-all duration-300 flex flex-col gap-3 h-full ${isDone ? 'border-green-200 bg-green-50' : 'border-gray-100'}`, children: [_jsxs("div", { className: "flex items-center gap-4", children: [_jsx("div", { className: `w-10 h-10 rounded-full flex items-center justify-center font-bold shrink-0 transition ${isDone ? 'bg-green-500 text-white' : 'bg-orange-100 text-orange-600'}`, children: isDone ? '✓' : toLocalNum(index + 1, language) }), _jsx("div", { className: "flex-1", children: _jsxs("div", { className: "flex justify-between items-center", children: [_jsx("h4", { className: `font-bold ${isDone ? 'text-green-800 line-through' : 'text-gray-800'}`, children: exercise.name }), _jsx("span", { className: "text-sm text-teal-600 font-bold", children: exercise.duration })] }) })] }), !isDone && (_jsxs("div", { className: "flex-1 flex flex-col", children: [_jsxs("div", { className: "inline-block bg-blue-50 text-blue-700 text-xs px-2 py-1 rounded-md mb-2 font-bold border border-blue-100 self-start", children: ["\u23F0 ", exercise.bestTime || "Any Time"] }), _jsx("p", { className: "text-sm text-gray-500 leading-relaxed mb-3 flex-1", children: exercise.description }), _jsxs("div", { className: "flex gap-2 flex-wrap mt-auto", children: [_jsxs("a", { href: `https://www.youtube.com/results?search_query=${encodeURIComponent(searchQuery)}`, target: "_blank", rel: "noopener noreferrer", className: "flex-1 inline-flex items-center justify-center gap-2 bg-red-50 text-red-600 px-4 py-2 rounded-lg text-sm font-bold hover:bg-red-100 transition whitespace-nowrap", children: ["\uD83C\uDFA5 ", t.video] }), _jsxs("button", { onClick: onToggle, className: "flex-1 bg-teal-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-teal-700 transition shadow-sm", children: ["\u2705 ", t.finish] })] })] })), isDone && (_jsxs("div", { className: "mr-14", children: [_jsxs("p", { className: "text-xs text-green-700 font-bold mb-2", children: ["\uD83D\uDD25 ", t.burned, " ", toLocalNum(exercise.estimatedCaloriesBurned || 50, language)] }), _jsx("button", { onClick: onToggle, className: "text-xs text-gray-400 underline", children: t.undo })] }))] }));
};
export default Plans;
